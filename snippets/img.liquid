{%- liquid

  # ** PURPOSE **
  # 'img' snippet generates HTML Image element with srcset automatically generated by utilizing Shopify's image size parameter.

  # ** PARAMETERS **
  # src               =>  REQUIRED | image object
  # src_mobile        =>  OPTIONAL | image object
  # aspect_ratio      =>  OPTIONAL | string: 'portrait', 'landscape', 'square' | default: "natural"
  # alt               =>  OPTIONAL | string | default: src.alt
  # background_color  =>  OPTIONAL | string | default: transparent | e.g. 'transparent', '#fff'
  # custom_classes    =>  OPTIONAL | string | 'sm-item-span-2'
  # custom_width      =>  OPTIONAL | integer | e.g. 300
  # custom_height     =>  OPTIONAL | integer | e.g. 300
  # item_id           =>  OPTIONAL | string | default: nill
  # lazyload          =>  OPTIONAL | true/false | default: false
  # preload           =>  OPTIONAL | true/false | default: false
  # placeholder       =>  OPTIONAL | string | default: 'image' | e.g. 'image', 'collection-1', 'product-1' etc...
  # sizes             =>  OPTIONAL | string | default: 100vw | e.g. (min-width: 1200px) 600px, (min-width: 750px) calc((100vw - 130px) / 2))
  # sizing_rule       =>  OPTIONAL | string: 'cover', 'contain' | default: cover
  # wrapped           =>  OPTIONAL | true/false | default: true

  # ** NOTES **
  # - Images are wrapped inside .media class so the aspect ratio is contained. To disable automatic wrapping set wrapped as false.
  # - custom_classes only used with wrapper


  if placeholder == null
    assign placeholder = 'image'
  endif

  if wrapped == null
    assign wrapped = true
  endif

  assign sizing_rule = sizing_rule | default: 'cover'
  assign background_color = background_color | default: 'transparent'
-%}

{%- comment -%}
  PRELOAD REMOVED: All critical image preloads are now handled in theme.liquid <head>
  for optimal performance and to avoid duplicate preload warnings.

  The preload parameter is kept for backward compatibility but is now a no-op.
  Critical images (hero, product featured) are preloaded via theme.liquid lines 88-100.
{%- endcomment -%}

{%- if wrapped -%}
  <figure class="media {{ sizing_rule }} {{ aspect_ratio | default: 'natural' }}{% if src == blank %} media--empty{% endif %} {{ custom_classes }}"{% if item_id != blank %} id="{{ item_id }}"{% endif %}{% if background_color != 'transparent' %} style="background-color: {{ background_color }};"{% endif %}>
{%- endif -%}

{%- if src_mobile -%}
<picture>
  {%- if src_mobile.width >= 390 -%}
    <source media="(max-width: 390px)" srcset="{{ src_mobile | image_url: width: 390 }}, {{ src_mobile | image_url: width: 780 }} 2x">
  {%- endif -%}
  {%- if src_mobile.width >= 540 -%}
    <source media="(max-width: 540px)" srcset="{{ src_mobile | image_url: width: 540 }}, {{ src_mobile | image_url: width: 1080 }} 2x">
  {%- endif -%}
  {%- if src_mobile.width >= 767 -%}
    <source media="(max-width: 767px)" srcset="{{ src_mobile | image_url: width: 767 }}, {{ src_mobile | image_url: width: 1534 }} 2x">
  {%- else -%}
    <source media="(max-width: 767px)" srcset="{{ src_mobile | image_url: width: 767 }}, {{ src_mobile | image_url: width: 1534 }} 2x">
  {%- endif -%}
{%- endif -%}

{%- if src != blank -%}
  <img
    srcset="{%- if src.width >= 90 -%}{{ src | image_url: width: 90 }} 90w,{%- endif -%}
    {%- if src.width >= 128 -%}{{ src | image_url: width: 128 }} 128w,{%- endif -%}
    {%- if src.width >= 165 -%}{{ src | image_url: width: 165 }} 165w,{%- endif -%}
    {%- if src.width >= 180 -%}{{ src | image_url: width: 180 }} 180w,{%- endif -%}
    {%- if src.width >= 280 -%}{{ src | image_url: width: 280 }} 280w,{%- endif -%}
    {%- if src.width >= 390 -%}{{ src | image_url: width: 390 }} 390w,{%- endif -%}
    {%- if src.width >= 540 -%}{{ src | image_url: width: 540 }} 540w,{%- endif -%}
    {%- if src.width >= 768 -%}{{ src | image_url: width: 768 }} 768w,{%- endif -%}
    {%- if src.width >= 1080 -%}{{ src | image_url: width: 1080 }} 1080w,{%- endif -%}
    {%- if src.width >= 1280 -%}{{ src | image_url: width: 1280 }} 1280w,{%- endif -%}
    {%- if src.width >= 1500 -%}{{ src | image_url: width: 1500 }} 1500w,{%- endif -%}
    {{ src | image_url }} {{ src.width }}w"
    sizes="{{ sizes | default: '100vw' }}"
    src="{{ src | image_url: width: 1500 }}"
    alt="{%- if alt -%}{{ alt }}{%- else -%}{{ src.alt }}{%- endif -%}"
    {% if lazyload %}
    loading="lazy"
    fetchpriority="low"
    {% else %}
    fetchpriority="high"
    {% endif %}
    decoding="async"
    width="{{ custom_width | default: src.width }}"
    height="{{ custom_height | default: src.height }}"
    style="object-position: {{ src.presentation.focal_point | default: '50% 50%' }};">
{%- else -%}
  {{ placeholder | placeholder_svg_tag: 'placeholder-svg' }}
{%- endif -%}

{%- if src_mobile -%}
  </picture>
{%- endif -%}

{%- if wrapped -%}
  </figure>
{%- endif -%}